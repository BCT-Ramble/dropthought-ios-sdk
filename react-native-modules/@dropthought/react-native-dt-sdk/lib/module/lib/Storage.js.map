{"version":3,"names":["keyPrefix","cacheKeyPrefix","storage","getItem","setItem","removeItem","getAllKeys","multiRemove","storageKey","key","cacheKey","clear","keys","keysWithPrefix","filter","startsWith","clearCache","load","initValue","undefined","result","value","JSON","parse","e","save","data","stringify","console","log","loadData","saveData","removeData","loadCache","saveCache","initStorage"],"sources":["Storage.ts"],"sourcesContent":["const keyPrefix = '@dropthought/dt-sdk/';\nconst cacheKeyPrefix = `${keyPrefix}cache/`;\n\nexport interface Storage {\n  getItem(\n    key: string,\n    callback?: (error?: Error, result?: string) => void\n  ): Promise<string | null>;\n\n  setItem(\n    key: string,\n    value: string,\n    callback?: (error?: Error) => void\n  ): Promise<void>;\n\n  removeItem(key: string, callback?: (error?: Error) => void): Promise<void>;\n\n  getAllKeys(\n    callback?: (error?: Error, keys?: string[]) => void\n  ): Promise<string[]>;\n\n  multiRemove(\n    keys: string[],\n    callback?: (errors?: Error[]) => void\n  ): Promise<void>;\n}\n\nlet storage: Storage = {\n  async getItem() {\n    return null;\n  },\n  async setItem() {},\n  async removeItem() {},\n  async getAllKeys() {\n    return [];\n  },\n  async multiRemove() {},\n};\n\n/**\n * given 'program-report/pid/@favorite-filters' -> '@com.abc.com/program-report/pid/@favorite-filters'\n * @param {string} key\n * @returns {string}\n */\nexport const storageKey = (key: string) => {\n  return `${keyPrefix}${key}`;\n};\n\n/**\n * given 'program-report/pid/@favorite-filters' -> '@com.abc.com/cache/program-report/pid/@favorite-filters'\n * purpose: we can clear the cache by checking the prefix\n * @param {string} key\n * @returns {string}\n */\nexport const cacheKey = (key: string) => {\n  return `${cacheKeyPrefix}${key}`;\n};\n\n/**\n * @description only clear data that starts with '@bundle-id'\n */\nexport async function clear() {\n  const keys = await storage.getAllKeys();\n  const keysWithPrefix = keys.filter((key) => key.startsWith(keyPrefix));\n\n  await storage.multiRemove(keysWithPrefix);\n}\n\n/**\n * @description only clear data that starts with '@bundle-id/cache/'\n */\nexport async function clearCache() {\n  const keys = await storage.getAllKeys();\n  const keysWithPrefix = keys.filter((key) => key.startsWith(cacheKeyPrefix));\n\n  await storage.multiRemove(keysWithPrefix);\n}\n\n/**\n * @template T\n * @param {string} key\n * @param {T=} initValue\n * @returns {Promise<T>}\n */\nconst load = async (key: string, initValue = undefined) => {\n  let result = initValue;\n  try {\n    const value = await storage.getItem(key);\n    if (value !== null) {\n      result = JSON.parse(value);\n    }\n  } catch (e) {}\n  return result;\n};\n\n/**\n * @template T\n * @param {string} key\n * @param {T} data\n */\nconst save = async (key: string, data: any) => {\n  try {\n    await storage.setItem(key, JSON.stringify(data));\n  } catch (e) {\n    console.log('failed at save to storage', key, data);\n  }\n  return data;\n};\n\n/**\n * @template T\n * @param {string} key\n * @param {T=} initValue\n * @returns {Promise<T>}\n */\nexport const loadData = async (key: string, initValue = undefined) => {\n  return load(storageKey(key), initValue);\n};\n\n/**\n * @template T\n * @param {string} key\n * @param {T} data\n */\nexport const saveData = async (key: string, data: any) => {\n  return save(storageKey(key), data);\n};\n\n/**\n * @param {string} key\n */\nexport const removeData = async (key: string) => {\n  return storage.removeItem(storageKey(key));\n};\n\n/**\n * @template T\n * @param {string} key\n * @param {T=} initValue\n * @returns {Promise<T>}\n */\nexport const loadCache = async (key: string, initValue = undefined) => {\n  return load(cacheKey(key), initValue);\n};\n\n/**\n * @template T\n * @param {string} key\n * @param {T} data\n */\nexport const saveCache = async (key: string, data: any) => {\n  return save(cacheKey(key), data);\n};\n\nexport const initStorage = (storage: Storage) => {\n  storage = storage;\n};\n"],"mappings":"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"}