{"version":3,"names":["NativeModule","jwtDecode","isNil","pick","RENEW_ENDPOINT","DT_API_KEY_HEADER","DEFAULT_TIMEOUT","throwRequestError","mockAxiosResponse","response","name","message","data","error","status","isRequestTimeoutError","isNoInternetError","isTokenValid","jwtToken","jwtPayload","Date","now","exp","e","console","log","setRequestHeader","requestConfig","header","headers","restRequestConfig","Fetcher","constructor","param","_defineProperty","baseURL","timeout","Promise","resolve","undefined","url","init","authToken","apiKey","refreshToken","storeTokens","loadCache","saveCache","defaultRequestConfig","fetchWithTimeout","abortController","AbortController","cancelTimeout","timeoutId","setTimeout","abort","params","Object","keys","filter","key","map","encodeURIComponent","join","fetchURL","fetch","method","body","JSON","stringify","signal","then","r","isJSONContent","get","indexOf","value","entries","json","text","statusText","toString","catch","err","finally","clearTimeout","authorizeConfig","token","Authorization","tokenRenew","renewTokenIfNeeded","accessToken","request","_requestConfig$header","_requestConfig$header2","authRequired","cache","result"],"sources":["Fetcher.js"],"sourcesContent":["import { NativeModule } from 'react-native';\nimport jwtDecode from 'jwt-decode';\nimport { isNil, pick } from 'ramda';\n\nconst RENEW_ENDPOINT = '/api/token/renew';\nconst DT_API_KEY_HEADER = 'X-DT-API-KEY';\n\nconst DEFAULT_TIMEOUT = 30000; // default timeout: 30 seconds\n\n/**\n * @param {import('axios').AxiosResponse<any>} mockAxiosResponse\n */\nexport const throwRequestError = (mockAxiosResponse) => {\n  throw {\n    response: mockAxiosResponse,\n    name: 'RequestError',\n    message:\n      mockAxiosResponse.data.error ||\n      `Request failed with status code ${mockAxiosResponse.status}`,\n  };\n};\n\n/**\n * @param {Error} error\n */\nexport const isRequestTimeoutError = (error) => error.name === 'RequestTimeout';\n\n/**\n * @param {Error} error\n */\nexport const isNoInternetError = (error) =>\n  error.message === 'Network request failed';\n\nconst isTokenValid = (jwtToken) => {\n  let jwtPayload;\n\n  // decode token\n  try {\n    jwtPayload = jwtDecode(jwtToken);\n\n    // check expiration date\n    if (Date.now() >= jwtPayload.exp * 1000) {\n      return false;\n    } else {\n      return jwtPayload;\n    }\n  } catch (e) {\n    console.log('decode jwt failed', e);\n    return false;\n  }\n};\n\n/**\n * @param {RequestConfig} requestConfig\n * @param {object} header\n * @returns {RequestConfig}\n */\nconst setRequestHeader = (requestConfig, header = {}) => {\n  const { headers = {}, ...restRequestConfig } = requestConfig;\n  return {\n    headers: {\n      ...headers,\n      ...header,\n    },\n    ...restRequestConfig,\n  };\n};\n\n/**\n * @typedef {object}  InitializeParams\n * @property {string=} baseURL optional, if want to overwrite the baseURL\n * @property {number=} timeout optional, if want to overwrite the default timeout\n * @property {()=>Promise<string>=} authToken - optional, a function that returns the auth token or api-key\n * @property {()=>Promise<string>=} refreshToken - optional, a function that returns the refresh token\n * @property {(authTokens: AuthToken)=>Promise<any>=} storeTokens - optional, a function that tells the engine how to store tokens\n * @property {(url: string)=>Promise<any>=} loadCache - optional, a function that tells the engine how to load cache from this url\n * @property {(url: string, response: {data: any, status: number, statusText: string, headers: object})=>Promise<any>=} saveCache - optional, a function that tells the engine how to save cache\n * @property {string=} apiKey - or simply given the apiKey, optional\n */\nexport class Fetcher {\n  defaultRequestConfig = {\n    baseURL: '',\n    timeout: DEFAULT_TIMEOUT,\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json',\n    },\n  };\n\n  /** @type {() => Promise<string>} */\n  authToken = () => Promise.resolve(undefined);\n\n  /** @type {string | undefined} this is for api key version2 */\n  apiKey = undefined;\n\n  /** @type {() => Promise<string>} */\n  refreshToken = () => Promise.resolve(undefined);\n\n  /** @type {(authTokens: AuthToken) => Promise<undefined>} */\n  storeTokens = () => Promise.resolve(undefined);\n\n  /**\n   * @template T\n   * @type {(url: string) => Promise<T>}\n   */\n  loadCache = (url) => Promise.resolve(undefined);\n\n  /** @type {(url: string, response: {data: any, status: number, statusText: string}) => Promise<undefined>} */\n  saveCache = (url, response) => Promise.resolve(undefined);\n\n  /**\n   * @param {InitializeParams} param\n   */\n  constructor(param = {}) {\n    this.init(param);\n  }\n\n  /**\n   * @param {InitializeParams} param\n   */\n  init(param = {}) {\n    const {\n      baseURL,\n      timeout,\n      authToken,\n      apiKey,\n      refreshToken,\n      storeTokens,\n      loadCache,\n      saveCache,\n    } = param;\n\n    if (baseURL) {\n      this.defaultRequestConfig.baseURL = baseURL;\n    }\n    if (!isNil(timeout)) {\n      this.defaultRequestConfig.timeout = timeout;\n    }\n\n    if (authToken) {\n      this.authToken = authToken;\n    } else if (apiKey) {\n      this.apiKey = apiKey;\n      this.authToken = () => Promise.resolve(undefined);\n    }\n\n    if (refreshToken) {\n      this.refreshToken = refreshToken;\n    }\n\n    if (storeTokens) {\n      this.storeTokens = storeTokens;\n    }\n\n    if (loadCache) {\n      this.loadCache = loadCache;\n    }\n\n    if (saveCache) {\n      this.saveCache = saveCache;\n    }\n  }\n\n  /**\n   * @template T\n   * @param {string} url\n   * @param {RequestConfig} requestConfig\n   * @returns {import('axios').AxiosPromise<T>}\n   */\n  async fetchWithTimeout(url, requestConfig) {\n    // setting fetch abort (it is supported after RN 0.60)\n    // eslint-disable-next-line no-undef\n    const abortController = new AbortController();\n    const cancelTimeout =\n      requestConfig.timeout ||\n      this.defaultRequestConfig.timeout ||\n      DEFAULT_TIMEOUT;\n    const timeoutId = setTimeout(() => {\n      abortController.abort();\n    }, cancelTimeout);\n\n    // compose fetch params\n    const params = Object.keys(requestConfig.params || {})\n      .filter((key) => !isNil(requestConfig.params[key]))\n      .map((key) => `${key}=${encodeURIComponent(requestConfig.params[key])}`)\n      .join('&');\n    // compose fetch full URL\n    const fetchURL =\n      (requestConfig.baseURL || this.defaultRequestConfig.baseURL) +\n      url +\n      `?${params}`;\n\n    return await fetch(fetchURL, {\n      method: requestConfig.method || 'GET',\n      headers: {\n        ...this.defaultRequestConfig.headers,\n        ...requestConfig.headers,\n      },\n      body: requestConfig.body || JSON.stringify(requestConfig.data),\n      signal: abortController.signal,\n    })\n      .then(async (r) => {\n        const isJSONContent =\n          r.headers.get('content-type').indexOf('application/json') !== -1;\n\n        const headers = {};\n        if (r.headers) {\n          for (const [key, value] of r.headers.entries()) {\n            headers[key] = value;\n          }\n        }\n\n        /** @type {import('axios').AxiosResponse<any>} */\n        let mockAxiosResponse = {};\n        mockAxiosResponse.status = r.status;\n        mockAxiosResponse.data = isJSONContent\n          ? await r.json()\n          : await r.text();\n        mockAxiosResponse.headers = headers;\n        mockAxiosResponse.statusText = r.status.toString();\n\n        if (r.status >= 200 && r.status < 300) {\n          return mockAxiosResponse;\n        }\n        throwRequestError(mockAxiosResponse);\n      })\n      .catch((err) => {\n        if (err.name === 'AbortError' || err.message === 'Aborted') {\n          throw {\n            name: 'RequestTimeout',\n            message: `Request Timeout of ${cancelTimeout}ms.`,\n          };\n        }\n        throw err;\n      })\n      .finally(() => {\n        // clear timeout when request is final, success or failed\n        clearTimeout(timeoutId);\n      });\n  }\n\n  /**\n   * set the auth token to config\n   * @private\n   * @param {RequestConfig} requestConfig\n   * @returns {Promise<RequestConfig>}\n   */\n  async authorizeConfig(requestConfig) {\n    if (this.apiKey) {\n      return setRequestHeader(requestConfig, {\n        [DT_API_KEY_HEADER]: this.apiKey,\n      });\n    }\n    const token = await this.authToken();\n    if (!token) return requestConfig;\n\n    return setRequestHeader(requestConfig, {\n      Authorization: `Bearer ${token}`,\n    });\n  }\n\n  /** @returns {Promise<any>} */\n  async tokenRenew(timeout = DEFAULT_TIMEOUT) {\n    const refreshToken = await this.refreshToken();\n    if (!refreshToken) return;\n\n    return this.fetchWithTimeout(RENEW_ENDPOINT, {\n      method: 'POST',\n      data: {\n        refreshToken,\n      },\n      timeout,\n    }).then((response) => {\n      return this.storeTokens(response.data);\n    });\n  }\n\n  /**\n   * it checks if the authToken(accessToken) is valid (check the expiration date)\n   * if it is invalid, renew token\n   * @private\n   * @param {number=} timeout\n   */\n  async renewTokenIfNeeded(timeout) {\n    const refreshToken = await this.refreshToken();\n    if (!refreshToken) return;\n\n    const accessToken = await this.authToken();\n    if (!accessToken) return;\n\n    if (!isTokenValid(accessToken)) {\n      try {\n        await this.tokenRenew(timeout);\n      } catch (e) {\n        console.log('token renew failed', e.message);\n        throw e;\n      }\n    }\n  }\n\n  /**\n   * @public\n   * @template T\n   * @param {string} url\n   * @param {RequestConfig} requestConfig\n   * @returns {import('axios').AxiosPromise<T>}\n   */\n  async request(url, requestConfig) {\n    let authRequired = false;\n\n    if (requestConfig.headers?.Authorization || requestConfig.authRequired) {\n      authRequired = true;\n\n      // refresh token before sending out actual request\n      await this.renewTokenIfNeeded(requestConfig.timeout);\n      requestConfig = await this.authorizeConfig(requestConfig);\n    }\n\n    // read cached response\n    if (requestConfig.cache) {\n      const result = await this.loadCache(url);\n      if (result) return result;\n    }\n\n    // if auth is required, but there's no authorization, fail early before making a request\n    if (authRequired && !requestConfig.headers?.Authorization && !this.apiKey) {\n      return throwRequestError({\n        status: 401,\n        statusText: '401',\n        data: {},\n        headers: {},\n      });\n    }\n\n    let response = await this.fetchWithTimeout(url, requestConfig);\n\n    // if this request is authRequired and the response status is 401, try to renew token again\n    if (authRequired && response.status === 401 && !this.apiKey) {\n      await this.tokenRenew(requestConfig.timeout);\n\n      // query again with renewed token\n      requestConfig = await this.authorizeConfig(requestConfig);\n      response = await this.fetchWithTimeout(url, requestConfig);\n    }\n\n    // store response if cache is true\n    if (requestConfig.cache) {\n      await this.saveCache(\n        url,\n        pick(['data', 'status', 'statusText', 'headers'], response)\n      );\n    }\n\n    return response;\n  }\n}\n\n/**\n * @typedef {Object} AuthToken\n * @property {string} accessToken\n * @property {string} refreshToken\n */\n\n/**\n * @typedef {Object} CustomRequestConfig\n * @property {boolean} authRequired\n * @property {boolean} cache\n */\n\n/**\n * @typedef {import('axios').AxiosRequestConfig & CustomRequestConfig} RequestConfig\n */\n"],"mappings":"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"}