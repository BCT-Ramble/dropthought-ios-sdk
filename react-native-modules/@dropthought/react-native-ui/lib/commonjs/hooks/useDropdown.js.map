{"version":3,"sources":["useDropdown.ts"],"names":["useDropdown","question","feedback","onFeedback","questionId","responseErrorText","options","result","questionBrand","QuestionBrandType","Other","lastOption","length","title","i18n","t","placeholder","otherText","bottomSheetVisible","setBottomSheetVisible","selectedOptionIndex","setSelectedOptionIndex","selectedOptionIndexCache","setSelectedOptionIndexCache","renderList","setRenderList","searchText","setSearchText","setOtherText","hasEdited","setHasEdited","answers","isValid","metaDataType","searchedList","filter","toLocaleLowerCase","includes","currentSelectedOption","undefined","optionLabel","answer","indexOfOther","isOther","index","type","otherFlag","onChangeOtherText","text","onChangeSearchText","onCloseBottomSheet","onOpenBottomSheet","onConfirm","onCancel","invalidMessage"],"mappings":"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","sourcesContent":["import { useState, useEffect, useMemo } from 'react';\nimport { metaDataFormatValidator, getOptionsFromQuestion } from '../utils/data';\nimport i18n from '../translation';\nimport type { Question, Feedback } from '../data';\nimport { isNil } from 'ramda';\nimport { QuestionBrandType } from '../utils/data';\n\nconst useDropdown = (\n  question: Question,\n  feedback: Feedback,\n  onFeedback: (feedback: Feedback) => void\n) => {\n  const { questionId, responseErrorText } = question;\n\n  const options = useMemo(() => {\n    let result = getOptionsFromQuestion(question);\n    if (question.questionBrand === QuestionBrandType.Other) {\n      const lastOption = result[result.length - 1];\n      lastOption.title = i18n.t('common:others');\n      lastOption.placeholder =\n        isNil(question.otherText) || question.otherText === ''\n          ? i18n.t('survey:other-placeholder')\n          : question.otherText;\n    }\n    return result;\n  }, [question]);\n\n  const [bottomSheetVisible, setBottomSheetVisible] = useState(false);\n  const [selectedOptionIndex, setSelectedOptionIndex] = useState<number>();\n  const [selectedOptionIndexCache, setSelectedOptionIndexCache] =\n    useState<number>();\n  const [renderList, setRenderList] = useState(options);\n  const [searchText, setSearchText] = useState('');\n  const [otherText, setOtherText] = useState('');\n  const [hasEdited, setHasEdited] = useState(\n    feedback?.answers[0] && typeof feedback.answers[0] === 'string'\n      ? feedback.answers[0].length > 0\n      : false\n  );\n  const isValid = metaDataFormatValidator(otherText, question.metaDataType);\n\n  useEffect(() => {\n    const searchedList = options.filter(({ title }) => {\n      return title\n        .toLocaleLowerCase()\n        .includes(searchText.toLocaleLowerCase() || '');\n    });\n    setRenderList(searchedList);\n  }, [options, searchText]);\n\n  const currentSelectedOption = useMemo(() => {\n    return selectedOptionIndex !== undefined\n      ? options[selectedOptionIndex]\n      : undefined;\n  }, [options, selectedOptionIndex]);\n\n  const optionLabel = useMemo(() => {\n    return currentSelectedOption?.title ?? i18n.t('survey:select-Your-Option');\n  }, [currentSelectedOption]);\n\n  useEffect(() => {\n    if (feedback && feedback.answers && !isNil(feedback.answers[0])) {\n      const answer = feedback.answers[0];\n      if (typeof answer === 'number') {\n        setSelectedOptionIndex(answer);\n      } else {\n        // if the answer is not a number type,\n        // it is for other label, return the last index\n        setOtherText(answer);\n        const indexOfOther = options.length - 1;\n        setSelectedOptionIndex(indexOfOther);\n      }\n    }\n  }, [feedback, options.length]);\n\n  useEffect(() => {\n    if (currentSelectedOption === undefined) return;\n\n    if (!currentSelectedOption.isOther) {\n      setOtherText('');\n      onFeedback({\n        questionId: questionId,\n        answers: [currentSelectedOption.index],\n        type: 'dropdown',\n      });\n    } else if (currentSelectedOption.isOther) {\n      onFeedback({\n        questionId: questionId,\n        answers: [''],\n        type: 'dropdown',\n        otherFlag: true,\n      });\n    }\n  }, [currentSelectedOption, onFeedback, questionId]);\n\n  useEffect(() => {\n    if (currentSelectedOption && currentSelectedOption.isOther) {\n      onFeedback({\n        questionId: questionId,\n        answers: [otherText],\n        type: 'dropdown',\n        otherFlag: true,\n      });\n    }\n  }, [currentSelectedOption, onFeedback, otherText, questionId]);\n\n  const onChangeOtherText = (text: string) => {\n    setHasEdited(true);\n    setOtherText(text);\n  };\n\n  const onChangeSearchText = (text: string) => {\n    setSearchText(text);\n  };\n\n  const onCloseBottomSheet = () => {\n    setBottomSheetVisible(false);\n  };\n\n  const onOpenBottomSheet = () => {\n    setSelectedOptionIndexCache(selectedOptionIndex);\n    setBottomSheetVisible(true);\n  };\n\n  const onConfirm = () => {\n    setSelectedOptionIndex(selectedOptionIndexCache);\n    setSearchText('');\n    onCloseBottomSheet();\n  };\n\n  const onCancel = () => {\n    setSelectedOptionIndexCache(undefined);\n    setSearchText('');\n    onCloseBottomSheet();\n  };\n\n  return {\n    selectedOptionIndexCache,\n    setSelectedOptionIndexCache,\n\n    currentSelectedOption,\n    invalidMessage: hasEdited && !isValid ? responseErrorText : undefined,\n    bottomSheetVisible,\n    optionLabel,\n    renderList,\n    otherText,\n\n    onChangeOtherText,\n    onChangeSearchText,\n\n    onCloseBottomSheet,\n    onOpenBottomSheet,\n    onConfirm,\n    onCancel,\n  };\n};\n\nexport default useDropdown;\n"]}