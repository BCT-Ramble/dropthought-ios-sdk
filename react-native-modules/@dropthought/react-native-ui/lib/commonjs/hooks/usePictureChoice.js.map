{"version":3,"sources":["usePictureChoice.ts"],"names":["DefaultPictureAnswer","image","value","usePictureChoice","question","onFeedback","feedback","questionId","subType","questionBrand","optionImages","options","images","map","uri","index","option","otherPictureEnable","QuestionBrandType","Other","otherPictureAnswer","setOtherPictureAnswer","answers","lastItem","length","undefined","otherPictureSelected","setOtherPictureSelected","selectIndex","setSelectIndex","splice","filter","answer","isMultipleChoice","hasEdit","setHasEdit","result","type","otherFlag","resetOtherPicture","invalidMessage","setInvalidMessage","onSelectIndex","selected","prev","includes","item","replaceSelectIndex","selectedList","setOtherPictureAnswerText","text","setOtherPictureAnswerUrl","url"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\nimport { QuestionBrandType } from '../utils/data';\nimport type { Question, Feedback } from '../data';\n\nconst DefaultPictureAnswer = { image: '', value: '' };\n\nexport const usePictureChoice = (\n  question: Question,\n  onFeedback: (feedback: Feedback) => void,\n  feedback?: Feedback\n) => {\n  const { questionId, subType, questionBrand, optionImages, options } =\n    question;\n\n  const images = optionImages.map((uri, index) => {\n    return { uri, option: options?.[index] ?? '' };\n  });\n\n  const otherPictureEnable = questionBrand === QuestionBrandType.Other;\n\n  const [otherPictureAnswer, setOtherPictureAnswer] = useState(() => {\n    const { answers } = feedback ?? {};\n    const lastItem =\n      answers && answers.length > 0 ? answers[answers.length - 1] : undefined;\n    if (\n      lastItem &&\n      typeof lastItem !== 'number' &&\n      typeof lastItem !== 'string'\n    ) {\n      return { image: lastItem.image, value: lastItem.value };\n    } else {\n      return { image: '', value: '' };\n    }\n  });\n\n  const [otherPictureSelected, setOtherPictureSelected] = useState(\n    () =>\n      otherPictureAnswer.image.length > 0 || otherPictureAnswer.value.length > 0\n  );\n\n  const [selectIndex, setSelectIndex] = useState(() => {\n    const { answers } = feedback ?? {};\n    if (answers && answers.length > 0) {\n      if (otherPictureSelected) {\n        answers.splice(-1);\n        return answers.filter((answer) => typeof answer === 'number');\n      } else {\n        return answers.filter((answer) => typeof answer === 'number');\n      }\n    } else {\n      return [];\n    }\n  });\n\n  const isMultipleChoice = subType === 'multiChoice';\n\n  const [hasEdit, setHasEdit] = useState(() => {\n    return feedback !== undefined;\n  });\n\n  useEffect(() => {\n    if (hasEdit) {\n      const result = {\n        questionId,\n        answers: otherPictureSelected\n          ? [...selectIndex, otherPictureAnswer]\n          : selectIndex,\n        type: 'pictureChoice',\n        subType,\n        otherFlag: otherPictureSelected,\n      };\n      // @ts-ignore\n      onFeedback(result);\n    }\n  }, [\n    selectIndex,\n    otherPictureSelected,\n    otherPictureAnswer,\n    questionId,\n    onFeedback,\n    subType,\n    hasEdit,\n  ]);\n\n  const resetOtherPicture = () => {\n    setOtherPictureSelected(false);\n    setOtherPictureAnswer(DefaultPictureAnswer);\n  };\n\n  const [invalidMessage, setInvalidMessage] = useState<string | undefined>(\n    undefined\n  );\n\n  const onSelectIndex = (selected: number) => {\n    setHasEdit(true);\n    setSelectIndex((prev) => {\n      if (prev.includes(selected)) {\n        return prev?.filter((item) => item !== selected);\n      } else {\n        return [...prev, selected];\n      }\n    });\n  };\n\n  const replaceSelectIndex = (selectedList: number[] | []) => {\n    setHasEdit(true);\n    setSelectIndex(selectedList);\n  };\n\n  const setOtherPictureAnswerText = (text: string) => {\n    setHasEdit(true);\n    setOtherPictureAnswer((prev) => ({\n      ...prev,\n      value: text,\n    }));\n  };\n\n  const setOtherPictureAnswerUrl = (url: string) => {\n    setHasEdit(true);\n    setOtherPictureAnswer((prev) => ({\n      ...prev,\n      image: url,\n    }));\n  };\n\n  return {\n    images,\n    otherPictureEnable,\n\n    otherPictureAnswer,\n    setOtherPictureAnswerText,\n    setOtherPictureAnswerUrl,\n    otherPictureSelected,\n    setOtherPictureSelected,\n    selectIndex,\n    onSelectIndex,\n    replaceSelectIndex,\n\n    isMultipleChoice,\n\n    resetOtherPicture,\n    invalidMessage,\n    setInvalidMessage,\n  };\n};\n"]}