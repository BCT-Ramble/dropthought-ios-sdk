{"version":3,"sources":["MultiLineTextInput.tsx"],"names":["metadataTypeKeyboard","metadataType","toLocaleLowerCase","QuestionMetaDataType","Email","Phone","Number","Platform","select","ios","default","Date","metadataTypeAutoCapitalize","Name","MultiLineTextInput","onEndEditingHandler","onChangeTextHandler","themeColor","feedback","question","anonymous","inputRef","showErrorHint","checked","onBlurHandler","onFocusHandler","colorScheme","fontColor","metaDataType","otherText","questionBrand","scale","type","MAX_CHARACTER","appearanceTextColorStyle","color","answersIndex","answers","length","text","setText","React","useState","focus","setFocus","rtl","i18n","dir","showAnonymousWarning","hideSubscription","Keyboard","addListener","remove","onChangeText","t","characterLeft","bottomText","bottomTextColor","Colors","warningRed","black","appearanceSubBackgroundColorStyle","backgroundColor","COLOR_SCHEMES","dark","appearanceSubBlack","inputValidStyle","borderWidth","borderColor","textInputStyle","styles","inputContainer","GlobalStyle","textAlignRight","rightDescTextStyle","descText","descRight","opacity","leftDescTextStyle","descLeft","inputView","inputPlaceholder","bottomView","subTextRow","flexRowReverse"],"mappings":";;;;;;;AAAA;;AACA;;AAQA;;AACA;;AACA;;AAMA;;AACA;;AACA;;;;;;;;AAEO,MAAMA,oBAAoB,GAC/BC,YADkC,IAEE;AACpC,UAAQA,YAAR,aAAQA,YAAR,uBAAQA,YAAY,CAAEC,iBAAd,EAAR;AACE,SAAKC,2BAAqBC,KAA1B;AACE,aAAO,eAAP;;AACF,SAAKD,2BAAqBE,KAA1B;AACE,aAAO,WAAP;;AACF,SAAKF,2BAAqBG,MAA1B;AACE,aAAOC,sBAASC,MAAT,CAAgB;AACrBC,QAAAA,GAAG,EAAE,yBADgB;AAErBC,QAAAA,OAAO,EAAE;AAFY,OAAhB,CAAP;;AAIF,SAAKP,2BAAqBQ,IAA1B;AACA;AACE,aAAO,SAAP;AAZJ;AAcD,CAjBM;;;;AAmBA,MAAMC,0BAA0B,GACrCX,YADwC,IAErC;AACH,UAAQA,YAAR,aAAQA,YAAR,uBAAQA,YAAY,CAAEC,iBAAd,EAAR;AACE,SAAKC,2BAAqBU,IAA1B;AACE,aAAO,OAAP;;AACF,SAAKV,2BAAqBC,KAA1B;AACA,SAAKD,2BAAqBE,KAA1B;AACA,SAAKF,2BAAqBQ,IAA1B;AACA,SAAKR,2BAAqBG,MAA1B;AACE,aAAO,MAAP;;AACF;AACE,aAAO,WAAP;AATJ;AAWD,CAdM;;;;AA8BP,MAAMQ,kBAAmC,GAAG,CAAC;AAC3CC,EAAAA,mBAD2C;AAE3CC,EAAAA,mBAF2C;AAG3CC,EAAAA,UAH2C;AAI3CC,EAAAA,QAJ2C;AAK3CC,EAAAA,QAL2C;AAM3CC,EAAAA,SAN2C;AAO3CC,EAAAA,QAP2C;AAQ3CC,EAAAA,aAAa,GAAG,KAR2B;AAS3CC,EAAAA,OAAO,GAAG,IATiC;AAU3CC,EAAAA,aAAa,GAAG,MAAM,CAAE,CAVmB;AAW3CC,EAAAA,cAAc,GAAG,MAAM,CAAE;AAXkB,CAAD,KAYtC;AACJ,QAAM;AAAEC,IAAAA,WAAF;AAAeC,IAAAA;AAAf,MAA6B,sBAAnC;AACA,QAAM;AACJC,IAAAA,YADI;AAEJC,IAAAA,SAAS,GAAG,EAFR;AAGJC,IAAAA,aAAa,GAAG,EAHZ;AAIJC,IAAAA,KAAK,GAAG,EAJJ;AAKJC,IAAAA;AALI,MAMFb,QANJ;AAOA,QAAMc,aAAa,GAAGD,IAAI,KAAK,MAAT,GAAkB1B,MAAM,CAACyB,KAAD,CAAxB,GAAkC,GAAxD;AACA,QAAMG,wBAAwB,GAAG;AAAEC,IAAAA,KAAK,EAAER;AAAT,GAAjC,CAVI,CAWJ;;AACA,QAAMS,YAAY,GAAG,CAAAlB,QAAQ,SAAR,IAAAA,QAAQ,WAAR,YAAAA,QAAQ,CAAEmB,OAAV,CAAkBC,MAAlB,IAA2B,CAAhD;;AACA,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBC,eAAMC,QAAN,CACtB,QAAOxB,QAAP,aAAOA,QAAP,uBAAOA,QAAQ,CAAEmB,OAAV,CAAkBD,YAAlB,CAAP,MAA2C,QAA3C,GACK,GAAElB,QAAH,aAAGA,QAAH,uBAAGA,QAAQ,CAAEmB,OAAV,CAAkBD,YAAlB,CAAgC,EADvC,GAEI,EAHkB,CAAxB;;AAKA,QAAM,CAACO,KAAD,EAAQC,QAAR,IAAoBH,eAAMC,QAAN,CAAe,KAAf,CAA1B;;AAEA,QAAMG,GAAG,GAAGC,qBAAKC,GAAL,OAAe,KAA3B;AACA,QAAMC,oBAAoB,GACxB5B,SAAS,IACTQ,YADA,KAECA,YAAY,KAAK,OAAjB,IACCA,YAAY,KAAK,MADlB,IAECA,YAAY,KAAK,OAJnB,CADF;AAOA,wBAAU,MAAM;AACd,UAAMqB,gBAAgB,GAAGC,sBAASC,WAAT,CAAqB,iBAArB,EAAwC,MAAM;AACrEpC,MAAAA,mBAAmB,IAAIA,mBAAmB,EAA1C;AACD,KAFwB,CAAzB;;AAIA,WAAO,MAAM;AACXkC,MAAAA,gBAAgB,CAACG,MAAjB;AACD,KAFD,CALc,CAQd;AACD,GATD,EASG,EATH;;AAWA,QAAMC,YAAY,GAAIC,CAAD,IAAe;AAClC;AACA,QAAIX,KAAJ,EAAW;AACTH,MAAAA,OAAO,CAACc,CAAD,CAAP;AACD;;AACDtC,IAAAA,mBAAmB,IAAIA,mBAAmB,CAACsC,CAAD,CAA1C;AACD,GAND;;AAQA,QAAMC,aAAa,GAAGtB,aAAa,GAAGM,IAAI,CAACD,MAA3C;AAEA,MAAIkB,UAAU,GAAG,EAAjB;AACA,MAAIC,eAAe,GAAGC,eAAOC,UAA7B;;AACA,MAAIX,oBAAJ,EAA0B;AACxBQ,IAAAA,UAAU,GAAGV,qBAAKQ,CAAL,CAAO,mCAAP,CAAb;AACAG,IAAAA,eAAe,GAAG,+BAAkBC,eAAOE,KAAzB,EAAgC,GAAhC,CAAlB;AACD;;AAED,QAAMC,iCAAiC,GAAG;AACxCC,IAAAA,eAAe,EAAE,+BACfpC,WAAW,KAAKqC,sBAAcC,IAA9B,GACIN,eAAOO,kBADX,GAEIhD,UAHW,EAIf,IAJe;AADuB,GAA1C;AAQA,QAAMiD,eAAe,GAAG;AACtBC,IAAAA,WAAW,EAAE,CADS;AAEtBC,IAAAA,WAAW,EAAEV,eAAOC;AAFE,GAAxB;AAIA,QAAMU,cAAc,GAAG,CACrBC,4BAAOC,cADc,EAErBrC,wBAFqB,EAGrB2B,iCAHqB,EAIrBvC,aAAa,GAAG4C,eAAH,GAAqB,IAJb,EAKrBrB,GAAG,IAAI2B,oBAAYC,cALE,CAAvB;AAOA,QAAMC,kBAAkB,GAAG,CACzBJ,4BAAOK,QADkB,EAEzBL,4BAAOM,SAFkB,EAGzB1C,wBAHyB,EAIzB;AAAE2C,IAAAA,OAAO,EAAE;AAAX,GAJyB,CAA3B;AAMA,QAAMC,iBAAiB,GAAG,CACxBR,4BAAOK,QADiB,EAExBL,4BAAOS,QAFiB,EAGxB;AACE5C,IAAAA,KAAK,EAAEsB;AADT,GAHwB,CAA1B;;AAQA,QAAMuB,SAAS,gBACb,6BAAC,sBAAD;AACE,IAAA,GAAG,EAAE3D,QADP;AAEE,IAAA,KAAK,EAAEgD,cAFT;AAGE,IAAA,SAAS,EAAE,IAHb;AAIE,IAAA,YAAY,EAAEhB,YAJhB;AAKE,IAAA,OAAO,EAAE,MAAM;AACbT,MAAAA,QAAQ,CAAC,IAAD,CAAR;AACAnB,MAAAA,cAAc;AACf,KARH;AASE,IAAA,MAAM,EAAE,MAAM;AACZmB,MAAAA,QAAQ,CAAC,KAAD,CAAR;AACApB,MAAAA,aAAa;AACd,KAZH;AAaE,IAAA,WAAW,EACTK,SAAS,CAACS,MAAV,GAAmB,CAAnB,GACIT,SADJ,GAEIC,aAAa,CAACQ,MAAd,GAAuB,CAAvB,GACAR,aADA,GAEAgB,qBAAKQ,CAAL,CAAO,0BAAP,CAlBR;AAoBE,IAAA,oBAAoB,EAAEI,eAAOuB,gBApB/B;AAqBE,IAAA,KAAK,EAAE1C,IArBT;AAsBE,IAAA,SAAS,EAAEN,aAtBb;AAuBE,IAAA,YAAY,EAAEjC,oBAAoB,CAAC4B,YAAD,CAvBpC;AAwBE,IAAA,cAAc,EAAEhB,0BAA0B,CAACgB,YAAD;AAxB5C,IADF;;AA6BA,QAAMsD,UAAU,gBACd,6BAAC,iBAAD;AAAM,IAAA,KAAK,EAAE,CAACZ,4BAAOa,UAAR,EAAoBtC,GAAG,IAAI2B,oBAAYY,cAAvC;AAAb,kBACE,6BAAC,iBAAD;AAAM,IAAA,KAAK,EAAEN,iBAAb;AAAgC,IAAA,aAAa,EAAE;AAA/C,KACGtB,UADH,CADF,eAIE,6BAAC,iBAAD;AAAM,IAAA,KAAK,EAAEkB;AAAb,KACGnB,aAAa,GAAG,KAAhB,GAAwBtB,aAD3B,CAJF,CADF;;AAWA,sBACE,4DACGV,OAAO,gBACN,6BAAC,iBAAD,QACGyD,SADH,EAEGE,UAFH,CADM,GAKJ,IANN,CADF;AAUD,CAvJD;;eAyJepE,kB","sourcesContent":["import React, { useEffect } from 'react';\nimport {\n  View,\n  Text,\n  TextInput,\n  KeyboardTypeOptions,\n  Platform,\n  Keyboard,\n} from 'react-native';\nimport styles from './MultiLineTextInput.styles';\nimport { QuestionMetaDataType } from '../../utils/data';\nimport i18n from '../../translation';\nimport type {\n  Question,\n  QuestionMetaDataType as TypeQuestionMetaDataType,\n  Feedback,\n} from '../../data';\nimport { Colors, addOpacityToColor, GlobalStyle } from '../../styles';\nimport { useTheme } from '../../contexts/theme';\nimport { COLOR_SCHEMES } from '../../contexts/theme/theme.const';\n\nexport const metadataTypeKeyboard = (\n  metadataType: TypeQuestionMetaDataType | undefined\n): KeyboardTypeOptions | undefined => {\n  switch (metadataType?.toLocaleLowerCase()) {\n    case QuestionMetaDataType.Email:\n      return 'email-address';\n    case QuestionMetaDataType.Phone:\n      return 'phone-pad';\n    case QuestionMetaDataType.Number:\n      return Platform.select({\n        ios: 'numbers-and-punctuation',\n        default: 'default',\n      });\n    case QuestionMetaDataType.Date:\n    default:\n      return 'default';\n  }\n};\n\nexport const metadataTypeAutoCapitalize = (\n  metadataType: TypeQuestionMetaDataType | undefined\n) => {\n  switch (metadataType?.toLocaleLowerCase()) {\n    case QuestionMetaDataType.Name:\n      return 'words';\n    case QuestionMetaDataType.Email:\n    case QuestionMetaDataType.Phone:\n    case QuestionMetaDataType.Date:\n    case QuestionMetaDataType.Number:\n      return 'none';\n    default:\n      return 'sentences';\n  }\n};\n\ninterface Props {\n  onEndEditingHandler?: () => void;\n  onChangeTextHandler?: (t: string) => void;\n  onBlurHandler?: () => void;\n  onFocusHandler?: () => void;\n  themeColor: string;\n  feedback: Feedback;\n  question: Question;\n  anonymous?: boolean;\n  inputRef?: React.RefObject<TextInput>;\n  showErrorHint?: boolean;\n  checked?: boolean;\n}\n\nconst MultiLineTextInput: React.FC<Props> = ({\n  onEndEditingHandler,\n  onChangeTextHandler,\n  themeColor,\n  feedback,\n  question,\n  anonymous,\n  inputRef,\n  showErrorHint = false,\n  checked = true,\n  onBlurHandler = () => {},\n  onFocusHandler = () => {},\n}) => {\n  const { colorScheme, fontColor } = useTheme();\n  const {\n    metaDataType,\n    otherText = '',\n    questionBrand = '',\n    scale = 64,\n    type,\n  } = question;\n  const MAX_CHARACTER = type === 'open' ? Number(scale) : 100;\n  const appearanceTextColorStyle = { color: fontColor };\n  // to keep answer always select the last one\n  const answersIndex = feedback?.answers.length - 1;\n  const [text, setText] = React.useState<string>(\n    typeof feedback?.answers[answersIndex] === 'string'\n      ? `${feedback?.answers[answersIndex]}`\n      : ''\n  );\n  const [focus, setFocus] = React.useState(false);\n\n  const rtl = i18n.dir() === 'rtl';\n  const showAnonymousWarning =\n    anonymous &&\n    metaDataType &&\n    (metaDataType === 'Email' ||\n      metaDataType === 'Name' ||\n      metaDataType === 'Phone');\n\n  useEffect(() => {\n    const hideSubscription = Keyboard.addListener('keyboardDidHide', () => {\n      onEndEditingHandler && onEndEditingHandler();\n    });\n\n    return () => {\n      hideSubscription.remove();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const onChangeText = (t: string) => {\n    // [DK-3756] if the text is close to the maxLength it will be rendered twice in the iOS, so we add the focus to prevent the issue.\n    if (focus) {\n      setText(t);\n    }\n    onChangeTextHandler && onChangeTextHandler(t);\n  };\n\n  const characterLeft = MAX_CHARACTER - text.length;\n\n  let bottomText = '';\n  let bottomTextColor = Colors.warningRed;\n  if (showAnonymousWarning) {\n    bottomText = i18n.t('survey:metadata-anonymous-warning');\n    bottomTextColor = addOpacityToColor(Colors.black, 0.6);\n  }\n\n  const appearanceSubBackgroundColorStyle = {\n    backgroundColor: addOpacityToColor(\n      colorScheme === COLOR_SCHEMES.dark\n        ? Colors.appearanceSubBlack\n        : themeColor,\n      0.08\n    ),\n  };\n  const inputValidStyle = {\n    borderWidth: 1,\n    borderColor: Colors.warningRed,\n  };\n  const textInputStyle = [\n    styles.inputContainer,\n    appearanceTextColorStyle,\n    appearanceSubBackgroundColorStyle,\n    showErrorHint ? inputValidStyle : null,\n    rtl && GlobalStyle.textAlignRight,\n  ];\n  const rightDescTextStyle = [\n    styles.descText,\n    styles.descRight,\n    appearanceTextColorStyle,\n    { opacity: 0.8 },\n  ];\n  const leftDescTextStyle = [\n    styles.descText,\n    styles.descLeft,\n    {\n      color: bottomTextColor,\n    },\n  ];\n\n  const inputView = (\n    <TextInput\n      ref={inputRef}\n      style={textInputStyle}\n      multiline={true}\n      onChangeText={onChangeText}\n      onFocus={() => {\n        setFocus(true);\n        onFocusHandler();\n      }}\n      onBlur={() => {\n        setFocus(false);\n        onBlurHandler();\n      }}\n      placeholder={\n        otherText.length > 0\n          ? otherText\n          : questionBrand.length > 0\n          ? questionBrand\n          : i18n.t('survey:other-placeholder')\n      }\n      placeholderTextColor={Colors.inputPlaceholder}\n      value={text}\n      maxLength={MAX_CHARACTER}\n      keyboardType={metadataTypeKeyboard(metaDataType)}\n      autoCapitalize={metadataTypeAutoCapitalize(metaDataType)}\n    />\n  );\n\n  const bottomView = (\n    <View style={[styles.subTextRow, rtl && GlobalStyle.flexRowReverse]}>\n      <Text style={leftDescTextStyle} numberOfLines={2}>\n        {bottomText}\n      </Text>\n      <Text style={rightDescTextStyle}>\n        {characterLeft + ' / ' + MAX_CHARACTER}\n      </Text>\n    </View>\n  );\n\n  return (\n    <>\n      {checked ? (\n        <View>\n          {inputView}\n          {bottomView}\n        </View>\n      ) : null}\n    </>\n  );\n};\n\nexport default MultiLineTextInput;\n"]}