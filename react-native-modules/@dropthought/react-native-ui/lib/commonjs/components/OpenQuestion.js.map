{"version":3,"sources":["OpenQuestion.tsx"],"names":["OpenQuestion","anonymous","question","onFeedback","feedback","forgot","themeColor","rtl","i18n","dir","backgroundColor","text","setText","React","useState","answers","textRef","useRef","hasEdited","setHasEdited","isValid","metaDataType","appearanceBackgroundColorStyle","tempFeedback","questionId","type","hasForgot","onEndEditingHandler","current","onChangeTextHandler","t","upperView","styles","responseErrorText","container","memo","StyleSheet","create","flex","paddingHorizontal","marginBottom"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { ScrollView, StyleSheet, View } from 'react-native';\nimport {\n  metaDataFormatValidator,\n  mandatoryQuestionValidator,\n} from '../utils/data';\nimport MandatoryTitle from './MandatoryTitle';\nimport i18n from '../translation';\nimport { useTheme } from '../contexts/theme';\nimport type { Question, Feedback } from '../data';\nimport MultiLineTextInput from './MultiLineTextInput';\nimport MetadataDesc from './MetadataDesc';\n\ntype Props = {\n  anonymous: boolean;\n  question: Question;\n  onFeedback: (feedback: Feedback) => void;\n  feedback: Feedback;\n  forgot: boolean;\n  themeColor: string;\n};\n\nconst OpenQuestion = ({\n  anonymous,\n  question,\n  // onValueChange, // Keep it for Kiosk usage\n  onFeedback,\n  feedback,\n  forgot,\n  themeColor,\n}: Props) => {\n  const rtl = i18n.dir() === 'rtl';\n  const { backgroundColor } = useTheme();\n  const [text, setText] = React.useState<string>(\n    feedback?.answers[0] ? `${feedback?.answers[0]}` : ''\n  );\n  const textRef = React.useRef<string>(\n    feedback?.answers[0] ? `${feedback?.answers[0]}` : ''\n  );\n  const [hasEdited, setHasEdited] = React.useState(false);\n\n  // It will be used in valid title\n  const isValid = metaDataFormatValidator(text, question.metaDataType);\n\n  const appearanceBackgroundColorStyle = {\n    backgroundColor: backgroundColor,\n  };\n\n  /** @type {Feedback} */\n  const tempFeedback = {\n    questionId: question.questionId,\n    answers: [text],\n    type: 'open',\n  };\n\n  // It will be used in valid title\n  const hasForgot =\n    forgot && !mandatoryQuestionValidator(question, tempFeedback);\n\n  const onEndEditingHandler = () => {\n    setHasEdited(true);\n    onFeedback({\n      questionId: question.questionId,\n      answers: [textRef.current],\n      type: 'open',\n    });\n  };\n\n  const onChangeTextHandler = (t: string) => {\n    setText(t);\n    textRef.current = t;\n  };\n\n  const upperView = (\n    <View style={styles.upperView}>\n      <MandatoryTitle\n        forgot={hasForgot}\n        invalidMessage={\n          // show the error message after the user has done edited\n          hasEdited && !isValid\n            ? question.responseErrorText ??\n              i18n.t('metadata-invalid-message', question.metaDataType)\n            : ''\n        }\n        question={question}\n      />\n      <MetadataDesc question={question} rtl={rtl} />\n    </View>\n  );\n\n  return (\n    <ScrollView style={[styles.container, appearanceBackgroundColorStyle]}>\n      {upperView}\n      <MultiLineTextInput\n        onEndEditingHandler={onEndEditingHandler}\n        onChangeTextHandler={onChangeTextHandler}\n        themeColor={themeColor}\n        feedback={feedback}\n        question={question}\n        anonymous={anonymous}\n        showErrorHint={hasForgot || (hasEdited && !isValid)}\n      />\n    </ScrollView>\n  );\n};\n\nexport default React.memo(OpenQuestion);\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    paddingHorizontal: 42,\n  },\n  upperView: {\n    marginBottom: 5,\n  },\n});\n"]}