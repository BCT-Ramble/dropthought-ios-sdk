{"version":3,"sources":["PictureChoiceQuestion.tsx"],"names":["React","View","StyleSheet","ScrollView","RNScrollView","Platform","GlobalStyle","PictureChoiceItem","PictureChoiceOtherItem","usePictureChoice","MandatoryTitle","KeyboardAvoidingScrollView","i18n","OS","PictureChoiceQuestion","survey","question","feedback","onFeedback","forgot","themeColor","onUpload","preview","otherText","images","otherPictureEnable","otherPictureAnswer","setOtherPictureAnswerText","setOtherPictureAnswerUrl","otherPictureSelected","setOtherPictureSelected","selectIndex","onSelectIndex","replaceSelectIndex","isMultipleChoice","resetOtherPicture","invalidMessage","setInvalidMessage","rtl","dir","imageItems","map","uri","option","index","selected","includes","onPress","undefined","toString","otherImageItem","length","t","file","url","msg","text","styles","container","mandatoryErrorMessage","mandatoryTitle","pictureGridContainer","flexRowReverse","memo","create","paddingHorizontal","flex1","marginBottom","flexDirection","flexWrap"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SACEC,IADF,EAEEC,UAFF,EAGEC,UAAU,IAAIC,YAHhB,EAIEC,QAJF,QAKO,cALP;AAMA,OAAOC,WAAP,MAAwB,WAAxB;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,OAAOC,sBAAP,MAAmC,0BAAnC;AACA,SAASC,gBAAT,QAAiC,2BAAjC;AAEA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,SAASC,0BAAT,QAA2C,wBAA3C;AACA,OAAOC,IAAP,MAAiB,gBAAjB;AAEA,MAAMT,UAAU,GACdE,QAAQ,CAACQ,EAAT,KAAgB,KAAhB,GAAwBF,0BAAxB,GAAqDP,YADvD;;AAeA,MAAMU,qBAAqB,GAAG,CAAC;AAC7BC,EAAAA,MAD6B;AAE7BC,EAAAA,QAF6B;AAG7BC,EAAAA,QAH6B;AAI7BC,EAAAA,UAJ6B;AAK7BC,EAAAA,MAL6B;AAM7BC,EAAAA,UAN6B;AAO7BC,EAAAA,QAP6B;AAQ7BC,EAAAA;AAR6B,CAAD,KASjB;AACX,QAAM;AAAEC,IAAAA,SAAS,GAAG;AAAd,MAAqBP,QAA3B;AAEA,QAAM;AACJQ,IAAAA,MADI;AAEJC,IAAAA,kBAFI;AAGJC,IAAAA,kBAHI;AAIJC,IAAAA,yBAJI;AAKJC,IAAAA,wBALI;AAMJC,IAAAA,oBANI;AAOJC,IAAAA,uBAPI;AAQJC,IAAAA,WARI;AASJC,IAAAA,aATI;AAUJC,IAAAA,kBAVI;AAWJC,IAAAA,gBAXI;AAYJC,IAAAA,iBAZI;AAaJC,IAAAA,cAbI;AAcJC,IAAAA;AAdI,MAeF5B,gBAAgB,CAACO,QAAD,EAAWE,UAAX,EAAuBD,QAAvB,CAfpB;AAgBA,QAAMqB,GAAG,GAAG1B,IAAI,CAAC2B,GAAL,OAAe,KAA3B;AAEA,QAAMC,UAAU,GAAGhB,MAAM,CAACiB,GAAP,CAAW,CAAC;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,GAAD,EAAkBC,KAAlB,KAA4B;AACxD,UAAMC,QAAQ,GAAGd,WAAW,CAACe,QAAZ,CAAqBF,KAArB,CAAjB;;AAEA,UAAMG,OAAO,GAAG,MAAM;AACpBV,MAAAA,iBAAiB,CAACW,SAAD,CAAjB;;AACA,UAAId,gBAAJ,EAAsB;AACpBF,QAAAA,aAAa,CAACY,KAAD,CAAb;AACD,OAFD,MAEO;AACLX,QAAAA,kBAAkB,CAAC,CAACW,KAAD,CAAD,CAAlB;AACAT,QAAAA,iBAAiB;AAClB;AACF,KARD;;AASA,wBACE,oBAAC,iBAAD;AACE,MAAA,KAAK,EAAEQ,MADT;AAEE,MAAA,GAAG,EAAED,GAFP;AAGE,MAAA,gBAAgB,EAAER,gBAHpB;AAIE,MAAA,QAAQ,EAAEW,QAJZ;AAKE,MAAA,SAAS,EAAE,EALb;AAME,MAAA,OAAO,EAAEE,OANX;AAOE,MAAA,KAAK,EAAEH,KAPT;AAQE,MAAA,UAAU,EAAExB,UARd;AASE,MAAA,GAAG,EAAEwB,KAAK,CAACK,QAAN;AATP,MADF;AAaD,GAzBkB,CAAnB;AA2BA,QAAMC,cAAc,GAAGzB,kBAAkB,gBACvC,oBAAC,sBAAD;AACE,IAAA,YAAY,EAAEC,kBADhB;AAEE,IAAA,gBAAgB,EAAEQ,gBAFpB;AAGE,IAAA,QAAQ,EAAEL,oBAHZ;AAIE,IAAA,WAAW,EACTN,SAAS,CAAC4B,MAAV,GAAmB,CAAnB,GAAuB5B,SAAvB,GAAmCX,IAAI,CAACwC,CAAL,CAAO,0BAAP,CALvC;AAOE,IAAA,SAAS,EAAE,EAPb;AAQE,IAAA,aAAa,EAAE,MAAM;AACnB,UAAI,CAAClB,gBAAL,EAAuB;AACrBD,QAAAA,kBAAkB,CAAC,EAAD,CAAlB;AACD;;AACDH,MAAAA,uBAAuB,CAAC,IAAD,CAAvB;AACD,KAbH;AAcE,IAAA,QAAQ,EAAE,MAAM;AACd,UAAID,oBAAJ,EAA0B;AACxBQ,QAAAA,iBAAiB,CAACW,SAAD,CAAjB;AACAb,QAAAA,iBAAiB;AAClB,OAHD,MAGO;AACL,YAAI,CAACD,gBAAL,EAAuB;AACrBD,UAAAA,kBAAkB,CAAC,EAAD,CAAlB;AACD;;AACDH,QAAAA,uBAAuB,CAAC,IAAD,CAAvB;AACD;AACF,KAxBH;AAyBE,IAAA,QAAQ,EAAE,MAAOuB,IAAP,IAAgB;AACxBhB,MAAAA,iBAAiB,CAACW,SAAD,CAAjB;AACA,YAAMM,GAAG,GAAG,MAAMjC,QAAQ,CAACgC,IAAD,CAA1B;;AACA,UAAI,OAAOC,GAAP,KAAe,QAAnB,EAA6B;AAC3BjB,QAAAA,iBAAiB,CAAE,GAAEzB,IAAI,CAACwC,CAAL,CAAO,6BAAP,CAAsC,EAA1C,CAAjB;AACD,OAFD,MAEO,IAAIE,GAAJ,EAAS;AACd1B,QAAAA,wBAAwB,CAAC0B,GAAD,CAAxB;AACD;AACF,KAjCH;AAkCE,IAAA,OAAO,EAAGC,GAAD,IAAS;AAChBlB,MAAAA,iBAAiB,CAACkB,GAAD,CAAjB;AACD,KApCH;AAqCE,IAAA,YAAY,EAAGC,IAAD,IAAU;AACtB7B,MAAAA,yBAAyB,CAAC6B,IAAD,CAAzB;AACD,KAvCH;AAwCE,IAAA,UAAU,EAAEpC,UAxCd;AAyCE,IAAA,OAAO,EAAEE;AAzCX,IADuC,GA4CrC,IA5CJ;AA8CA,sBACE,oBAAC,UAAD;AAAY,IAAA,kBAAkB,EAAE,EAAhC;AAAoC,IAAA,KAAK,EAAEmC,MAAM,CAACC;AAAlD,kBACE,oBAAC,cAAD;AACE,IAAA,MAAM,EAAEvC,MADV;AAEE,IAAA,qBAAqB,EAAEJ,MAAM,CAAC4C,qBAFhC;AAGE,IAAA,QAAQ,EAAE3C,QAHZ;AAIE,IAAA,KAAK,EAAEyC,MAAM,CAACG,cAJhB;AAKE,IAAA,cAAc,EAAExB;AALlB,IADF,eAQE,oBAAC,IAAD;AACE,IAAA,KAAK,EAAE,CAACqB,MAAM,CAACI,oBAAR,EAA8BvB,GAAG,IAAIhC,WAAW,CAACwD,cAAjD;AADT,KAGGtB,UAHH,EAIGU,cAJH,CARF,CADF;AAiBD,CAxHD;;AA0HA,4BAAelD,KAAK,CAAC+D,IAAN,CAAWjD,qBAAX,CAAf;AAEA,MAAM2C,MAAM,GAAGvD,UAAU,CAAC8D,MAAX,CAAkB;AAC/BN,EAAAA,SAAS,EAAE;AACTO,IAAAA,iBAAiB,EAAE,EADV;AAET,OAAG3D,WAAW,CAAC4D;AAFN,GADoB;AAK/BN,EAAAA,cAAc,EAAE;AACdO,IAAAA,YAAY,EAAE;AADA,GALe;AAQ/BN,EAAAA,oBAAoB,EAAE;AACpBO,IAAAA,aAAa,EAAE,KADK;AAEpBC,IAAAA,QAAQ,EAAE;AAFU;AARS,CAAlB,CAAf","sourcesContent":["import React from 'react';\nimport {\n  View,\n  StyleSheet,\n  ScrollView as RNScrollView,\n  Platform,\n} from 'react-native';\nimport GlobalStyle from '../styles';\nimport PictureChoiceItem from './PictureChoiceItem';\nimport PictureChoiceOtherItem from './PictureChoiceOtherItem';\nimport { usePictureChoice } from '../hooks/usePictureChoice';\nimport type { Question, Feedback, ImageFileProps, Survey } from '../data';\nimport MandatoryTitle from './MandatoryTitle';\nimport { KeyboardAvoidingScrollView } from './KeyboardAvoidingView';\nimport i18n from '../translation';\n\nconst ScrollView =\n  Platform.OS === 'ios' ? KeyboardAvoidingScrollView : RNScrollView;\n\ntype Props = {\n  survey: Survey;\n  question: Question;\n  onFeedback: (feedback: Feedback) => void;\n  onUpload: (file: ImageFileProps) => Promise<string | undefined>;\n  isUploading: boolean;\n  feedback?: Feedback;\n  forgot: boolean;\n  themeColor: string;\n  preview: boolean;\n};\n\nconst PictureChoiceQuestion = ({\n  survey,\n  question,\n  feedback,\n  onFeedback,\n  forgot,\n  themeColor,\n  onUpload,\n  preview,\n}: Props) => {\n  const { otherText = '' } = question;\n\n  const {\n    images,\n    otherPictureEnable,\n    otherPictureAnswer,\n    setOtherPictureAnswerText,\n    setOtherPictureAnswerUrl,\n    otherPictureSelected,\n    setOtherPictureSelected,\n    selectIndex,\n    onSelectIndex,\n    replaceSelectIndex,\n    isMultipleChoice,\n    resetOtherPicture,\n    invalidMessage,\n    setInvalidMessage,\n  } = usePictureChoice(question, onFeedback, feedback);\n  const rtl = i18n.dir() === 'rtl';\n\n  const imageItems = images.map(({ uri, option }, index) => {\n    const selected = selectIndex.includes(index);\n\n    const onPress = () => {\n      setInvalidMessage(undefined);\n      if (isMultipleChoice) {\n        onSelectIndex(index);\n      } else {\n        replaceSelectIndex([index]);\n        resetOtherPicture();\n      }\n    };\n    return (\n      <PictureChoiceItem\n        title={option}\n        uri={uri}\n        isMultipleChoice={isMultipleChoice}\n        selected={selected}\n        columnGap={24}\n        onPress={onPress}\n        index={index}\n        themeColor={themeColor}\n        key={index.toString()}\n      />\n    );\n  });\n\n  const otherImageItem = otherPictureEnable ? (\n    <PictureChoiceOtherItem\n      otherPicture={otherPictureAnswer}\n      isMultipleChoice={isMultipleChoice}\n      selected={otherPictureSelected}\n      placeholder={\n        otherText.length > 0 ? otherText : i18n.t('survey:other-placeholder')\n      }\n      columnGap={24}\n      onChooseImage={() => {\n        if (!isMultipleChoice) {\n          replaceSelectIndex([]);\n        }\n        setOtherPictureSelected(true);\n      }}\n      onSelect={() => {\n        if (otherPictureSelected) {\n          setInvalidMessage(undefined);\n          resetOtherPicture();\n        } else {\n          if (!isMultipleChoice) {\n            replaceSelectIndex([]);\n          }\n          setOtherPictureSelected(true);\n        }\n      }}\n      onUpload={async (file) => {\n        setInvalidMessage(undefined);\n        const url = await onUpload(file);\n        if (typeof url !== 'string') {\n          setInvalidMessage(`${i18n.t('picture-choice:uploadFailed')}`);\n        } else if (url) {\n          setOtherPictureAnswerUrl(url);\n        }\n      }}\n      onError={(msg) => {\n        setInvalidMessage(msg);\n      }}\n      onChangeText={(text) => {\n        setOtherPictureAnswerText(text);\n      }}\n      themeColor={themeColor}\n      preview={preview}\n    />\n  ) : null;\n\n  return (\n    <ScrollView extraAvoidingSpace={30} style={styles.container}>\n      <MandatoryTitle\n        forgot={forgot}\n        mandatoryErrorMessage={survey.mandatoryErrorMessage}\n        question={question}\n        style={styles.mandatoryTitle}\n        invalidMessage={invalidMessage}\n      />\n      <View\n        style={[styles.pictureGridContainer, rtl && GlobalStyle.flexRowReverse]}\n      >\n        {imageItems}\n        {otherImageItem}\n      </View>\n    </ScrollView>\n  );\n};\n\nexport default React.memo(PictureChoiceQuestion);\n\nconst styles = StyleSheet.create({\n  container: {\n    paddingHorizontal: 30,\n    ...GlobalStyle.flex1,\n  },\n  mandatoryTitle: {\n    marginBottom: 12,\n  },\n  pictureGridContainer: {\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n  },\n});\n"]}