{"version":3,"sources":["WheelPicker.tsx"],"names":["React","useEffect","useMemo","useRef","useState","Animated","View","styles","WheelPickerItem","WheelPicker","selectedIndex","options","onChange","selectedIndicatorStyle","containerStyle","itemStyle","itemTextStyle","itemHeight","rotationFunction","x","Math","pow","opacityFunction","visibleRest","decelerationRate","containerProps","flatListRef","scrollY","Value","containerHeight","paddedOptions","array","i","unshift","push","offsets","Array","length","map","_","currentScrollIndex","add","divide","handleMomentumScrollEnd","event","offsetY","nativeEvent","contentOffset","y","index","floor","last","current","scrollToIndex","animated","container","height","selectedIndicator","transform","translateY","scrollView","useNativeDriver","offset","toString","item"],"mappings":"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","sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport {\n  StyleProp,\n  TextStyle,\n  NativeSyntheticEvent,\n  NativeScrollEvent,\n  Animated,\n  ViewStyle,\n  View,\n  ViewProps,\n  FlatList,\n} from 'react-native';\nimport styles from './WheelPicker.styles';\nimport WheelPickerItem from './WheelPickerItem';\n\ninterface Props {\n  selectedIndex: number;\n  options: string[];\n  onChange: (index: number) => void;\n  selectedIndicatorStyle?: StyleProp<ViewStyle>;\n  itemTextStyle?: StyleProp<TextStyle>;\n  itemStyle?: ViewStyle;\n  itemHeight?: number;\n  containerStyle?: ViewStyle;\n  containerProps?: Omit<ViewProps, 'style'>;\n  rotationFunction?: (x: number) => number;\n  opacityFunction?: (x: number) => number;\n  visibleRest?: number;\n  decelerationRate?: 'normal' | 'fast' | number;\n}\n\nconst WheelPicker: React.FC<Props> = ({\n  selectedIndex,\n  options,\n  onChange,\n  selectedIndicatorStyle = {},\n  containerStyle = {},\n  itemStyle = {},\n  itemTextStyle = {},\n  itemHeight = 40,\n  rotationFunction = (x: number) => 1 - Math.pow(1 / 2, x),\n  opacityFunction = (x: number) => Math.pow(1 / 3, x),\n  visibleRest = 2,\n  decelerationRate = 'fast',\n  containerProps = {},\n}) => {\n  const flatListRef = useRef<FlatList>(null);\n  const [scrollY] = useState(new Animated.Value(0));\n\n  const containerHeight = (1 + visibleRest * 2) * itemHeight;\n  const paddedOptions = useMemo(() => {\n    const array: (string | null)[] = [...options];\n    for (let i = 0; i < visibleRest; i++) {\n      array.unshift(null);\n      array.push(null);\n    }\n    return array;\n  }, [options, visibleRest]);\n\n  const offsets = useMemo(\n    () => [...Array(paddedOptions.length)].map((_, i) => i * itemHeight),\n    [paddedOptions, itemHeight]\n  );\n\n  const currentScrollIndex = useMemo(\n    () => Animated.add(Animated.divide(scrollY, itemHeight), visibleRest),\n    [visibleRest, scrollY, itemHeight]\n  );\n\n  const handleMomentumScrollEnd = (\n    event: NativeSyntheticEvent<NativeScrollEvent>\n  ) => {\n    const offsetY = event.nativeEvent.contentOffset.y;\n    let index = Math.floor(Math.floor(offsetY) / itemHeight);\n    const last = Math.floor(offsetY % itemHeight);\n    if (last > itemHeight / 2) index++;\n\n    if (index !== selectedIndex) {\n      onChange(index);\n    }\n  };\n\n  /**\n   * If selectedIndex is changed from outside (not via onChange) we need to scroll to the specified index.\n   * This ensures that what the user sees as selected in the picker always corresponds to the value state.\n   */\n  useEffect(() => {\n    flatListRef.current?.scrollToIndex({\n      index: selectedIndex,\n      animated: false,\n    });\n  }, [selectedIndex]);\n\n  return (\n    <View\n      style={[styles.container, { height: containerHeight }, containerStyle]}\n      {...containerProps}\n    >\n      <View\n        style={[\n          styles.selectedIndicator,\n          selectedIndicatorStyle,\n          {\n            transform: [{ translateY: -itemHeight / 2 }],\n            height: itemHeight,\n          },\n        ]}\n      />\n      <Animated.FlatList\n        ref={flatListRef}\n        style={styles.scrollView}\n        showsVerticalScrollIndicator={false}\n        onScroll={Animated.event(\n          [{ nativeEvent: { contentOffset: { y: scrollY } } }],\n          { useNativeDriver: true }\n        )}\n        onMomentumScrollEnd={handleMomentumScrollEnd}\n        snapToOffsets={offsets}\n        decelerationRate={decelerationRate}\n        initialScrollIndex={selectedIndex}\n        getItemLayout={(_: string, index: number) => ({\n          length: itemHeight,\n          offset: itemHeight * index,\n          index,\n        })}\n        data={paddedOptions}\n        keyExtractor={(_: string, index: number) => index.toString()}\n        renderItem={({ item, index }: { item: string; index: number }) => (\n          <WheelPickerItem\n            key={`option-${index}`}\n            index={index}\n            option={item}\n            style={itemStyle}\n            textStyle={itemTextStyle}\n            height={itemHeight}\n            currentScrollIndex={currentScrollIndex}\n            rotationFunction={rotationFunction}\n            opacityFunction={opacityFunction}\n            visibleRest={visibleRest}\n          />\n        )}\n      />\n    </View>\n  );\n};\n\nexport default WheelPicker;\n"]}