{"version":3,"sources":["OpenQuestion.tsx"],"names":["React","ScrollView","StyleSheet","View","metaDataFormatValidator","mandatoryQuestionValidator","MandatoryTitle","i18n","useTheme","MultiLineTextInput","MetadataDesc","OpenQuestion","anonymous","question","onFeedback","feedback","forgot","themeColor","rtl","dir","backgroundColor","text","setText","useState","answers","textRef","useRef","hasEdited","setHasEdited","isValid","metaDataType","appearanceBackgroundColorStyle","tempFeedback","questionId","type","hasForgot","onEndEditingHandler","current","onChangeTextHandler","t","upperView","styles","responseErrorText","container","memo","create","flex","paddingHorizontal","marginBottom"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { ScrollView, StyleSheet, View } from 'react-native';\nimport {\n  metaDataFormatValidator,\n  mandatoryQuestionValidator,\n} from '../utils/data';\nimport MandatoryTitle from './MandatoryTitle';\nimport i18n from '../translation';\nimport { useTheme } from '../contexts/theme';\nimport type { Question, Feedback } from '../data';\nimport MultiLineTextInput from './MultiLineTextInput';\nimport MetadataDesc from './MetadataDesc';\n\ntype Props = {\n  anonymous: boolean;\n  question: Question;\n  onFeedback: (feedback: Feedback) => void;\n  feedback: Feedback;\n  forgot: boolean;\n  themeColor: string;\n};\n\nconst OpenQuestion = ({\n  anonymous,\n  question,\n  // onValueChange, // Keep it for Kiosk usage\n  onFeedback,\n  feedback,\n  forgot,\n  themeColor,\n}: Props) => {\n  const rtl = i18n.dir() === 'rtl';\n  const { backgroundColor } = useTheme();\n  const [text, setText] = React.useState<string>(\n    feedback?.answers[0] ? `${feedback?.answers[0]}` : ''\n  );\n  const textRef = React.useRef<string>(\n    feedback?.answers[0] ? `${feedback?.answers[0]}` : ''\n  );\n  const [hasEdited, setHasEdited] = React.useState(false);\n\n  // It will be used in valid title\n  const isValid = metaDataFormatValidator(text, question.metaDataType);\n\n  const appearanceBackgroundColorStyle = {\n    backgroundColor: backgroundColor,\n  };\n\n  /** @type {Feedback} */\n  const tempFeedback = {\n    questionId: question.questionId,\n    answers: [text],\n    type: 'open',\n  };\n\n  // It will be used in valid title\n  const hasForgot =\n    forgot && !mandatoryQuestionValidator(question, tempFeedback);\n\n  const onEndEditingHandler = () => {\n    setHasEdited(true);\n    onFeedback({\n      questionId: question.questionId,\n      answers: [textRef.current],\n      type: 'open',\n    });\n  };\n\n  const onChangeTextHandler = (t: string) => {\n    setText(t);\n    textRef.current = t;\n  };\n\n  const upperView = (\n    <View style={styles.upperView}>\n      <MandatoryTitle\n        forgot={hasForgot}\n        invalidMessage={\n          // show the error message after the user has done edited\n          hasEdited && !isValid\n            ? question.responseErrorText ??\n              i18n.t('metadata-invalid-message', question.metaDataType)\n            : ''\n        }\n        question={question}\n      />\n      <MetadataDesc question={question} rtl={rtl} />\n    </View>\n  );\n\n  return (\n    <ScrollView style={[styles.container, appearanceBackgroundColorStyle]}>\n      {upperView}\n      <MultiLineTextInput\n        onEndEditingHandler={onEndEditingHandler}\n        onChangeTextHandler={onChangeTextHandler}\n        themeColor={themeColor}\n        feedback={feedback}\n        question={question}\n        anonymous={anonymous}\n        showErrorHint={hasForgot || (hasEdited && !isValid)}\n      />\n    </ScrollView>\n  );\n};\n\nexport default React.memo(OpenQuestion);\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    paddingHorizontal: 42,\n  },\n  upperView: {\n    marginBottom: 5,\n  },\n});\n"]}