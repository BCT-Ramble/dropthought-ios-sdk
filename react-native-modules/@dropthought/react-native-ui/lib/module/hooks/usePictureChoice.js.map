{"version":3,"sources":["usePictureChoice.ts"],"names":["useEffect","useState","QuestionBrandType","DefaultPictureAnswer","image","value","usePictureChoice","question","onFeedback","feedback","questionId","subType","questionBrand","optionImages","options","images","map","uri","index","option","otherPictureEnable","Other","otherPictureAnswer","setOtherPictureAnswer","answers","lastItem","length","undefined","otherPictureSelected","setOtherPictureSelected","selectIndex","setSelectIndex","splice","filter","answer","isMultipleChoice","hasEdit","setHasEdit","result","type","otherFlag","resetOtherPicture","invalidMessage","setInvalidMessage","onSelectIndex","selected","prev","includes","item","replaceSelectIndex","selectedList","setOtherPictureAnswerText","text","setOtherPictureAnswerUrl","url"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\nimport { QuestionBrandType } from '../utils/data';\nimport type { Question, Feedback } from '../data';\n\nconst DefaultPictureAnswer = { image: '', value: '' };\n\nexport const usePictureChoice = (\n  question: Question,\n  onFeedback: (feedback: Feedback) => void,\n  feedback?: Feedback\n) => {\n  const { questionId, subType, questionBrand, optionImages, options } =\n    question;\n\n  const images = optionImages.map((uri, index) => {\n    return { uri, option: options?.[index] ?? '' };\n  });\n\n  const otherPictureEnable = questionBrand === QuestionBrandType.Other;\n\n  const [otherPictureAnswer, setOtherPictureAnswer] = useState(() => {\n    const { answers } = feedback ?? {};\n    const lastItem =\n      answers && answers.length > 0 ? answers[answers.length - 1] : undefined;\n    if (\n      lastItem &&\n      typeof lastItem !== 'number' &&\n      typeof lastItem !== 'string'\n    ) {\n      return { image: lastItem.image, value: lastItem.value };\n    } else {\n      return { image: '', value: '' };\n    }\n  });\n\n  const [otherPictureSelected, setOtherPictureSelected] = useState(\n    () =>\n      otherPictureAnswer.image.length > 0 || otherPictureAnswer.value.length > 0\n  );\n\n  const [selectIndex, setSelectIndex] = useState(() => {\n    const { answers } = feedback ?? {};\n    if (answers && answers.length > 0) {\n      if (otherPictureSelected) {\n        answers.splice(-1);\n        return answers.filter((answer) => typeof answer === 'number');\n      } else {\n        return answers.filter((answer) => typeof answer === 'number');\n      }\n    } else {\n      return [];\n    }\n  });\n\n  const isMultipleChoice = subType === 'multiChoice';\n\n  const [hasEdit, setHasEdit] = useState(() => {\n    return feedback !== undefined;\n  });\n\n  useEffect(() => {\n    if (hasEdit) {\n      const result = {\n        questionId,\n        answers: otherPictureSelected\n          ? [...selectIndex, otherPictureAnswer]\n          : selectIndex,\n        type: 'pictureChoice',\n        subType,\n        otherFlag: otherPictureSelected,\n      };\n      // @ts-ignore\n      onFeedback(result);\n    }\n  }, [\n    selectIndex,\n    otherPictureSelected,\n    otherPictureAnswer,\n    questionId,\n    onFeedback,\n    subType,\n    hasEdit,\n  ]);\n\n  const resetOtherPicture = () => {\n    setOtherPictureSelected(false);\n    setOtherPictureAnswer(DefaultPictureAnswer);\n  };\n\n  const [invalidMessage, setInvalidMessage] = useState<string | undefined>(\n    undefined\n  );\n\n  const onSelectIndex = (selected: number) => {\n    setHasEdit(true);\n    setSelectIndex((prev) => {\n      if (prev.includes(selected)) {\n        return prev?.filter((item) => item !== selected);\n      } else {\n        return [...prev, selected];\n      }\n    });\n  };\n\n  const replaceSelectIndex = (selectedList: number[] | []) => {\n    setHasEdit(true);\n    setSelectIndex(selectedList);\n  };\n\n  const setOtherPictureAnswerText = (text: string) => {\n    setHasEdit(true);\n    setOtherPictureAnswer((prev) => ({\n      ...prev,\n      value: text,\n    }));\n  };\n\n  const setOtherPictureAnswerUrl = (url: string) => {\n    setHasEdit(true);\n    setOtherPictureAnswer((prev) => ({\n      ...prev,\n      image: url,\n    }));\n  };\n\n  return {\n    images,\n    otherPictureEnable,\n\n    otherPictureAnswer,\n    setOtherPictureAnswerText,\n    setOtherPictureAnswerUrl,\n    otherPictureSelected,\n    setOtherPictureSelected,\n    selectIndex,\n    onSelectIndex,\n    replaceSelectIndex,\n\n    isMultipleChoice,\n\n    resetOtherPicture,\n    invalidMessage,\n    setInvalidMessage,\n  };\n};\n"]}